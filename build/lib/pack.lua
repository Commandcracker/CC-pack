local a={}local b={}local c={["\n"]="\\n",["\r"]="\\r",["\t"]="\\t",["\b"]="\\b",["\f"]="\\f",["\""]="\\\"",["\\"]="\\\\"}local function d(t)local e=0;for f,g in pairs(t)do if type(f)~="number"then return false elseif f>e then e=f end end;return e==#t end;local h={['\n']=true,['\r']=true,['\t']=true,[' ']=true,[',']=true,[':']=true}function b.removeWhite(i)while h[i:sub(1,1)]do i=i:sub(2)end;return i end;local function j(k,l,m,n)local i=""local function o(p)i=i..("\t"):rep(m)..p end;local function q(k,r,s,u,v)i=i..r;if l then i=i.."\n"m=m+1 end;for f,g in u(k)do o("")v(f,g)i=i..","if l then i=i.."\n"end end;if l then m=m-1 end;if i:sub(-2)==",\n"then i=i:sub(1,-3).."\n"elseif i:sub(-1)==","then i=i:sub(1,-2)end;o(s)end;if type(k)=="table"then assert(not n[k],"Cannot encode a table holding itself recursively")n[k]=true;if d(k)then q(k,"[","]",ipairs,function(f,g)i=i..j(g,l,m,n)end)else q(k,"{","}",pairs,function(f,g)assert(type(f)=="string","JSON object keys must be strings",2)i=i..j(f,l,m,n)i=i..(l and": "or":")..j(g,l,m,n)end)end elseif type(k)=="string"then i='"'..k:gsub("[%c\"\\]",c)..'"'elseif type(k)=="number"or type(k)=="boolean"then i=tostring(k)else error("JSON only supports arrays, objects, numbers, booleans, and strings",2)end;return i end;function b.encode(k)return j(k,false,0,{})end;function b.encodePretty(k)return j(k,true,0,{})end;local w={}for f,g in pairs(c)do w[g]=f end;function b.parseBoolean(i)if i:sub(1,4)=="true"then return true,b.removeWhite(i:sub(5))else return false,b.removeWhite(i:sub(6))end end;function b.parseNull(i)return nil,b.removeWhite(i:sub(5))end;local x={['e']=true,['E']=true,['+']=true,['-']=true,['.']=true}function b.parseNumber(i)local y=1;while x[i:sub(y,y)]or tonumber(i:sub(y,y))do y=y+1 end;local k=tonumber(i:sub(1,y-1))i=b.removeWhite(i:sub(y))return k,i end;function b.parseString(i)i=i:sub(2)local p=""while i:sub(1,1)~="\""do local z=i:sub(1,1)i=i:sub(2)assert(z~="\n","Unclosed string")if z=="\\"then local A=i:sub(1,1)i=i:sub(2)z=assert(w[z..A],"Invalid escape character")end;p=p..z end;return p,b.removeWhite(i:sub(2))end;function b.parseArray(i)i=b.removeWhite(i:sub(2))local k={}local y=1;while i:sub(1,1)~="]"do local g=nil;g,i=b.parseValue(i)k[y]=g;y=y+1;i=b.removeWhite(i)end;i=b.removeWhite(i:sub(2))return k,i end;function b.parseObject(i)i=b.removeWhite(i:sub(2))local k={}while i:sub(1,1)~="}"do local f,g=nil,nil;f,g,i=b.parseMember(i)k[f]=g;i=b.removeWhite(i)end;i=b.removeWhite(i:sub(2))return k,i end;function b.parseMember(i)local f=nil;f,i=b.parseValue(i)local k=nil;k,i=b.parseValue(i)return f,k,i end;function b.parseValue(i)local B=i:sub(1,1)if B=="{"then return b.parseObject(i)elseif B=="["then return b.parseArray(i)elseif tonumber(B)~=nil or x[B]then return b.parseNumber(i)elseif i:sub(1,4)=="true"or i:sub(1,5)=="false"then return b.parseBoolean(i)elseif B=="\""then return b.parseString(i)elseif i:sub(1,4)=="null"then return b.parseNull(i)end;return nil end;function b.decode(i)i=b.removeWhite(i)t=b.parseValue(i)return t end;function b.decodeFromFile(C)local D=assert(fs.open(C,"r"))local E=b.decode(D.readAll())D.close()return E end;pack_path="/etc/pack"packages_path=pack_path.."/packages"sources_list_path=pack_path.."/sources.list"sources_list_d_path=pack_path.."/sources.list.d"local function F(G,H)local I={}local J=1;local K,L=G.find(G,H,J)while K do table.insert(I,G.sub(G,J,K-1))J=L+1;K,L=G.find(G,H,J)end;table.insert(I,G.sub(G,J))return I end;local function M(N,C)local O=http.get(N)local D=fs.open(C,"w")D.write(O.readAll())D.close()O.close()end;function a.getSources()local P=io.open(sources_list_path,"r")local Q=P:read()local R={}while Q do table.insert(R,F(Q," "))Q=P:read()end;return R end;function a.fetchSources(S)local R=a.getSources()if S then print("Fetching")end;for T,U in pairs(R)do if S then print(U[1])end;M(U[2],sources_list_d_path.."/"..U[1])end end;function a.fixSources(S)if not fs.exists(sources_list_path)then local V=fs.open(sources_list_path,"w")V.write("pack https://raw.githubusercontent.com/Commandcracker/CC-pack/master/packages.json")V.close()a.fetchSources(S)end end;function a.loadPackage(C)for T,W in pairs(fs.list(C))do if W=="bin"or W=="programs"then for T,X in pairs(fs.list(C.."/"..W))do shell.setPath(shell.path()..":"..C.."/"..W.."/"..X)end elseif W=="lib"or W=="apis"then for T,Y in pairs(fs.list(C.."/"..W))do os.loadAPI(C.."/"..W.."/"..Y)end elseif W=="startup"or"startup.lua"then if fs.isDir(C.."/"..W)then for T,Z in pairs(fs.list(C.."/"..W))do shell.run(C.."/"..W.."/"..Z)end else shell.run(C.."/"..W)end end end end;function a.loadPackages()for T,_ in pairs(fs.list(packages_path))do for T,a0 in pairs(fs.list(packages_path.."/".._))do a.loadPackage(packages_path.."/".._.."/"..a0)end end end;function a.installPackage(a1,a2)for f,g in pairs(a2["files"])do M(g,packages_path.."/"..a1 .."/"..f)end;a.loadPackage(packages_path.."/"..a1)end;function a.isPackageInstalled(a1)return fs.exists(packages_path.."/"..a1)end;function a.removePackage(a1)fs.delete(packages_path.."/"..a1)end;function a.getPackages()packages={}for T,U in pairs(fs.list(sources_list_d_path))do local a3=fs.open(sources_list_d_path.."/"..U,"r")packages[U]=b.decode(a3.readAll())a3.close()end;return packages end;a.json=b;return a